import{e as ie,u as oe,g as p,c as j,V as i,j as e,I as b}from"./index-D3ZYKOMr.js";import{r as n,S as L}from"./icons-DbTSyZBX.js";import{T as ce}from"./Table-DMeoVDss.js";import{M as f}from"./Modal-C_lINF_8.js";import{M as de}from"./messageService-c5W-t2hR.js";import{F as me}from"./FileInput-BqOq6VSn.js";/* empty css                       */import{u as ue}from"./useInput-syuInLTh.js";import{g as xe}from"./index-Cwap1v3_.js";import"./react-DbHEDQBy.js";import"./Title-BuIfxpma.js";const Ce=()=>{const{user:r}=ie(),N=oe(),[A,v]=n.useState(!1),[F,q]=n.useState([]),[P,k]=n.useState(!1),[a,E]=n.useState(null),[$,w]=n.useState(!1),[C,W]=n.useState(null),[z,o]=n.useState(!1),[c,S]=n.useState(0),[_,I]=n.useState(0),[m,R]=n.useState(""),[O,D]=n.useState(!1),[U,V]=n.useState(!1),{values:Y,getPayload:G,reset:H,handleArrayChange:J}=ue({images:{value:[],required:!0}}),y=n.useCallback(async s=>{var l;try{v(!0);const t=await p.get(`/bookings?user_id=${s}`),g=t.data.data.find(d=>d.status==="pending"||d.status==="confirmed");E(g),q(t.data.data.filter(d=>d.status!=="pending"&&d.status!=="confirmed"))}catch(t){if(t instanceof j){i.error((l=t==null?void 0:t.response)==null?void 0:l.data.message);return}i.error("Something went wrong. Please try again.")}finally{v(!1)}},[]),K=async s=>{var l;if(s){w(!0);try{await p.patch("/update-booking-status",{id:s,status:"cancelled"}),i.success("Booking cancelled successfully"),await y(r.id)}catch(t){if(t instanceof j){i.error((l=t==null?void 0:t.response)==null?void 0:l.data.message);return}i.error("Something went wrong. Please try again.")}finally{w(!1)}}};n.useEffect(()=>{r&&y(r.id)},[y,r]);const Q=[{label:"Room Name",key:"room",render:s=>typeof s=="object"&&s!==null&&"room_name"in s?e.jsx("span",{className:"text-sm",children:s.room_name}):null},{label:"Check-In",key:"check_in"},{label:"Check-Out",key:"check_out"},{label:"Status",key:"status",render:s=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${xe(s)}`,children:s})},{label:"Action",key:"room_id",render:(s,l)=>{var t;return l.status==="completed"&&((t=l.feedback)==null?void 0:t.rate)!==null?e.jsx("div",{className:"flex space-x-1",children:[1,2,3,4,5].map(g=>e.jsx(L,{className:"w-6 h-6",fill:g<=l.feedback.rate?"yellow":"none",strokeWidth:1.5,stroke:"currentColor"},g))}):l.status==="cancelled"?e.jsx("span",{className:"text-sm text-gray-500",children:"No Action Required"}):e.jsx("button",{onClick:()=>X(s),className:"text-sm underline underline-offset-2 text-blue-500 cursor-pointer",children:"Write a Review"})}},{label:"Comment",key:"feedback",render:(s,l)=>{var t;return e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-semibold",children:(t=l.feedback)==null?void 0:t.comment})}}],X=async s=>{W(s),o(!0)},Z=async()=>{var s;if(C&&c&&m.trim()!==""){const l=G(Y);try{D(!0),await p.post("/feedbacks",{user_id:r==null?void 0:r.id,room_id:C,rate:c,comment:m,...l.images&&l.images.length>0?{images:l.images}:{}}),o(!1),R(""),S(0),H(),i.success("Review submitted successfully")}catch(t){if(t instanceof j){i.error((s=t==null?void 0:t.response)==null?void 0:s.data.message);return}i.error("Something went wrong. Please try again.")}finally{D(!1)}}},ee=async()=>{try{V(!0);const s=await de.createConvo({user_id:r==null?void 0:r.id,receiver_id:1,title:`Booking ID: ${a==null?void 0:a.id}`});if(s.message==="Conversation with this title already exists."){N(`/users/messages/${s.conversation.id}`);return}N(`/users/messages/${s.id}`)}catch{}},[se,u]=n.useState(!1),[M,te]=n.useState(null),[B,T]=n.useState(!1),[x,ae]=n.useState(null),[h,ne]=n.useState(null),le=s=>{te(s),u(!0)},re=async s=>{if(s.preventDefault(),!x||!h||!M){i.error("Please select both check-in and check-out dates.");return}const l={user_id:r==null?void 0:r.id,booking_id:M,check_in:x.toISOString().split("T")[0],check_out:h.toISOString().split("T")[0]};try{T(!0),await p.post("/change-schedule",l),i.success("Reschedule submitted successfully."),u(!1)}catch(t){console.error("Error submitting reschedule:",t),i.error("You have already made a request for this booking.")}finally{T(!1)}};return A?"Loading...":e.jsxs("div",{className:"flex flex-col gap-5 px-[0.1875rem]",children:[a&&e.jsxs("div",{className:"w-full rounded-2xl shadow-sm p-5 md:px-10 flex flex-col gap-5",children:[e.jsx("h1",{className:"text-primary font-bold",children:"Active Booking"}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-5 md:gap-20",children:[e.jsxs("div",{className:"flex gap-3 relative",children:[e.jsx("div",{className:" bg-primary w-[0.3125rem]"}),e.jsxs("div",{className:"w-full",children:[e.jsxs("p",{className:"text-sm font-bold text-primary",children:["Booking ID: ",a.id]}),e.jsx("p",{className:"text-gray-600",children:a.room.room_name})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-primary",children:"Number of Guests"}),e.jsxs("p",{className:"text-gray-600",children:[a.no_guests," guests"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-primary",children:"Check in/Checkout Date"}),e.jsxs("p",{className:"text-gray-600",children:[a.check_in," - ",a.check_out]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-primary",children:"Tour Type"}),e.jsxs("p",{className:"text-gray-600",children:[a.tour_type==="day"?"Day":"Overnight"," Tour"]})]}),e.jsxs("div",{onClick:()=>k(!0),children:[e.jsx("p",{className:"text-sm font-bold text-primary",children:"View all details"}),e.jsxs("p",{className:"text-gray-600 underline inline-flex gap-2 cursor-pointer",children:["Click here ",e.jsx(b,{name:"SquareArrowOutUpRight",size:15,color:"#387A57"})]})]})]}),e.jsxs("div",{className:" flex items-center justify-center border-t border-primary pt-3 gap-5 cursor-pointer",children:[e.jsxs("div",{onClick:ee,className:"flex items-center justify-center gap-2",children:[e.jsx(b,{name:"MessageCircle",size:30,color:"#387A57"}),e.jsx("p",{children:"Chat with the staff"})]}),e.jsxs("div",{onClick:()=>{le(a.id)},className:"flex items-center justify-center gap-2",children:[e.jsx(b,{name:"Calendar",size:30,color:"#387A57"}),e.jsx("p",{children:"Change Schedule"})]})]})]}),e.jsx(ce,{columns:Q,data:F,tableTitle:"Booking History"}),e.jsxs(f,{isOpen:se,setIsOpen:u,className:"max-w-2xl min-w-2xl",children:[e.jsx("p",{className:"text-xl font-semibold mb-4",children:"Change Check In and Check Out Date"}),e.jsxs("form",{onSubmit:re,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Check In Date"}),e.jsx("input",{type:"date",value:x?x.toISOString().split("T")[0]:"",onChange:s=>ae(s.target.value?new Date(s.target.value):null),className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Check Out Date"}),e.jsx("input",{type:"date",value:h?h.toISOString().split("T")[0]:"",onChange:s=>ne(s.target.value?new Date(s.target.value):null),className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"px-4 py-2 rounded-lg border border-gray-300 bg-white hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:B,className:"px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700",children:B?"Loading...":"Submit Request"})]})]})]}),e.jsx(f,{isOpen:a?P:!1,setIsOpen:k,className:"max-w-2xl min-w-2xl",children:a&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4 border-b pb-2",children:"Booking Details"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Room:"}),e.jsx("span",{children:a.room.room_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Check-in:"}),e.jsx("span",{children:a.check_in})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Check-out:"}),e.jsx("span",{children:a.check_out})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Tour Type:"}),e.jsxs("span",{children:[a.tour_type==="day"?"Day":"Overnight"," Tour"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Guests:"}),e.jsx("span",{children:a.no_guests})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Total Price:"}),e.jsxs("span",{children:["â‚±",parseFloat(a.total_price).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx("span",{className:"capitalize px-2 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-800",children:a.status})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-6",children:["You can still cancel this booking. ",e.jsx("span",{className:"font-medium text-gray-600",children:"Once confirmed, cancellation is no longer allowed."})]}),a.status==="pending"&&e.jsx("button",{onClick:()=>K(a.id),className:"mt-4 px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded",children:$?"Loading...":"Cancel Booking"})]})}),e.jsxs(f,{isOpen:z,setIsOpen:o,className:"max-w-2xl min-w-2xl",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6",children:"Leave a Review"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"rating",className:"block text-base font-medium text-slate-700",children:["Rating ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Select from 1 to 5 stars"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(s=>e.jsx(L,{onClick:()=>S(s),onMouseEnter:()=>I(s),onMouseLeave:()=>I(0),className:`w-8 h-8 transition-colors duration-200 cursor-pointer ${(_||c)>=s?"text-yellow-400":"text-gray-300 hover:text-yellow-200"}`,fill:(_||c)>=s?"currentColor":"none",strokeWidth:1.5},s))})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"review",className:"block text-base font-medium text-slate-700",children:["Your Feedback ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Share your experience with this booking"}),e.jsx("textarea",{id:"review",className:"w-full p-4 border border-gray-300 rounded-xl bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition shadow-sm",rows:5,placeholder:"Write your comment here...",value:m,onChange:s=>R(s.target.value)})]}),e.jsx("div",{children:e.jsx(me,{label:"Upload photos (optional)",name:"images",onChange:J,maxFiles:5})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-4 py-2 text-gray-700 border rounded hover:bg-gray-100",onClick:()=>o(!1),children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 text-white bg-primary rounded hover:bg-primary-dark",onClick:Z,disabled:c===0||m.trim()===""||O,children:O?"Loading...":"Submit"})]})]}),e.jsx(f,{isOpen:U,setIsOpen:o,className:"max-w-2xl ",children:e.jsx("p",{children:"Creating conversation, please wait..."})})]})};export{Ce as default};
