import{g as x,V as c,j as e,c as S}from"./index-D3ZYKOMr.js";import{T as H}from"./Table-DMeoVDss.js";import{r as t}from"./icons-DbTSyZBX.js";import{M as f}from"./Modal-C_lINF_8.js";import{g as N}from"./index-Cwap1v3_.js";import"./react-DbHEDQBy.js";import"./Title-BuIfxpma.js";const ee=()=>{const[_,w]=t.useState([]),[b,k]=t.useState(!1),[i,I]=t.useState(10),[h,T]=t.useState(1),[v,M]=t.useState(0),[B,j]=t.useState(!1),[n,O]=t.useState(null),[P,g]=t.useState(!1),[A,E]=t.useState(null),[D,L]=t.useState(null),[R,p]=t.useState(!1),[y,d]=t.useState(!1),[u,V]=t.useState(""),[C,F]=t.useState(u);t.useEffect(()=>{const s=setTimeout(()=>F(u),500);return()=>clearTimeout(s)},[u]);const o=t.useCallback(async(s=1)=>{try{k(!0);const a=await x.get("/bookings",{params:{per_page:i,page:s,search:C||void 0}});w(a.data.data);const l=a.data.meta||{};T(l.current_page??s),I(l.per_page??i),M(l.total??a.data.data.length)}catch(a){console.error(a),c.error("Failed to fetch bookings.")}finally{k(!1)}},[C,i]);t.useEffect(()=>{o(1)},[o]);const $=s=>{o(s)},G=s=>{O(s),j(!0)},U=async(s,a)=>{var l,r;if(s)try{d(!0),await x.patch("/update-booking-status",{id:s,status:a}),c.success("Status updated successfully"),g(!1),o(h)}catch(m){m instanceof S&&c.error(((r=(l=m==null?void 0:m.response)==null?void 0:l.data)==null?void 0:r.message)||"Error updating status")}finally{d(!1)}},q=async s=>{var a,l;if(s)try{d(!0),await x.patch("/update-check-in-status",{id:s,status:!0}),c.success("Checked in successfully"),p(!1),o(h)}catch(r){r instanceof S&&c.error(((l=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:l.message)||"Error checking in")}finally{d(!1)}},z=[{label:"Status",key:"status",render:s=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${N(s)}`,children:s})},{label:"Customer",key:"user",render:s=>{const a=s;return e.jsxs("span",{children:[a==null?void 0:a.first_name," ",a==null?void 0:a.last_name]})}},{label:"Room Name",key:"room",render:s=>e.jsx("span",{children:s==null?void 0:s.room_name})},{label:"Check-In",key:"check_in"},{label:"Check-Out",key:"check_out"},{label:"Change Status",key:"id",render:s=>e.jsx("button",{className:"text-blue-500 underline",onClick:()=>{E(s),g(!0)},children:"Change"})},{label:"Check-In",key:"room_id",render:s=>e.jsx("button",{className:"text-blue-500 underline",onClick:()=>{L(s),p(!0)},children:"Check In"})},{label:"View Details",key:"no_guests",render:(s,a)=>e.jsx("button",{className:"text-blue-500 underline",onClick:()=>G(a),children:"View"})}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search customer or room name...",className:"border px-3 py-2 rounded w-full max-w-sm",value:u,onChange:s=>V(s.target.value)})}),b?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"w-full p-4 bg-white rounded-2xl shadow-md animate-pulse",children:[e.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(120px,1fr))] gap-4 mb-2",children:Array.from({length:8}).map((s,a)=>e.jsx("div",{className:"h-4 bg-gray-300 rounded w-full"},a))}),e.jsx("div",{className:"space-y-2",children:Array.from({length:8}).map((s,a)=>e.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(120px,1fr))] gap-4",children:Array.from({length:8}).map((l,r)=>e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"},r))},a))}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx("div",{className:"h-6 w-20 bg-gray-300 rounded"}),e.jsx("div",{className:"h-6 w-32 bg-gray-300 rounded"}),e.jsx("div",{className:"h-6 w-20 bg-gray-300 rounded"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx(H,{columns:z,data:_,tableTitle:"All Bookings",currentPage:h,perPage:i,totalItems:v,onPageChange:$,loading:b}),e.jsxs(f,{isOpen:P,setIsOpen:g,children:[e.jsx("p",{className:"font-semibold text-xl mb-4",children:"Change Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:["completed","confirmed","cancelled"].map(s=>e.jsx("button",{className:`px-4 py-2 rounded ${s==="cancelled"?"bg-gray-200 text-gray-700":"bg-blue-500 text-white"}`,onClick:()=>U(A,s),children:y?"Loading...":s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsxs(f,{isOpen:R,setIsOpen:p,children:[e.jsx("p",{className:"font-semibold text-xl mb-4",children:"Check In Room"}),e.jsx("button",{className:"px-4 py-2 bg-blue-500 text-white rounded",onClick:()=>q(D),children:y?"Loading...":"Confirm Check-In"})]}),e.jsx(f,{isOpen:B,setIsOpen:j,className:"max-w-3xl",children:n&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-2xl font-semibold",children:[n.user.first_name," ",n.user.last_name]}),e.jsxs("p",{children:["Status: ",e.jsx("span",{className:`px-2 py-1 rounded-full ${N(n.status)}`,children:n.status})]}),e.jsxs("p",{children:["Room: ",n.room.room_name]}),e.jsxs("p",{children:["Check-In: ",n.check_in]}),e.jsxs("p",{children:["Check-Out: ",n.check_out]}),e.jsxs("p",{children:["Guests: ",n.no_guests]}),e.jsxs("p",{children:["Total Price: â‚±",n.total_price]})]})})]})]})};export{ee as default};
