import{r as s}from"./icons-DbTSyZBX.js";import{M as c}from"./messageService-c5W-t2hR.js";const R=(n,a)=>{const[d,l]=s.useState(!1),[y,g]=s.useState(!1),[S,f]=s.useState(!1),[o,p]=s.useState([]),[v,u]=s.useState([]),[_,M]=s.useState(""),i=s.useRef(null),b=s.useRef(!1),w=s.useMemo(()=>{var t;if(a)return(t=o.find(e=>e.id===Number(a)))==null?void 0:t.title},[a,o]);s.useEffect(()=>{n&&(async()=>{try{l(!0);const e=await c.getAllConvos(n);p(e),b.current=!0}catch(e){console.error(e)}finally{l(!1)}})()},[n]);const h=s.useCallback(async t=>{try{g(!0);const e=await c.getMessages(t);u(e),setTimeout(()=>{var r;(r=i.current)==null||r.scrollIntoView({behavior:"smooth"})},100)}catch(e){console.error(e)}finally{g(!1)}},[]);s.useEffect(()=>{n&&a&&h(a)},[n,a,h]);const C=t=>{u(e=>[...e,t])};return{conversationFetching:d,conversationList:o,messages:v,title:w,messageLoading:y,handleSendMessage:async t=>{try{f(!0);const e=await c.postMessage(a,{user_id:n,body:t}),r={id:e.id,conversation_id:e.conversation_id,user_id:e.user_id,body:e.body,created_at:e.created_at};C(r),M(""),setTimeout(()=>{var m;(m=i.current)==null||m.scrollIntoView({behavior:"smooth"})},100)}catch(e){console.error(e)}finally{f(!1)}},sendingMessage:S,message:_,setMessage:M,messageDivRef:i}};export{R as u};
